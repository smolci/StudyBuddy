@{
    Layout = "/Views/Shared/_Layout.cshtml";
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Study Buddy</title>
    <link rel="stylesheet" href="~/css/Index.css" asp-append-version="true" />
</head>

<body>
    <div class="app-shell">
        <main class="main-layout">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div>
                    <div class="sidebar-section-title">Navigation</div>

                    <li class="nav-item active">
                        <a asp-controller="Home" asp-action="Index" class="nav-link">
                            <span class="icon">🏠</span>
                            <span>Dashboard</span>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a asp-controller="StudyTasks" asp-action="Index" class="nav-link">
                            <span class="icon">✅</span>
                            <span>Tasks</span>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a asp-controller="Stats" asp-action="Index" class="nav-link">
                            <span class="icon">📊</span>
                            <span>Stats</span>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a asp-area="Identity" asp-page="/Account/Manage/Index" class="nav-link">
                            <span class="icon">⚙️</span>
                            <span>Settings</span>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a asp-controller="Subjects" asp-action="Index" class="nav-link">
                            <span class="icon">👨‍🏫</span>
                            <span>Subjects</span>
                        </a>
                    </li>


                    <div class="sidebar-section-title">Subjects</div>
                    <div class="project-chips">
                        @foreach (var subject in Model.Subjects)
                        {
                            <div class="chip">@subject.Name</div>
                        }
                    </div>

                    <div id="addSubjectChip" class="m-1">
                        <button id="showInputBtn" type="button" class="btn btn-primary rounded-circle"
                            style="width:30px; height:30px; padding: 0;">+</button>
                        <form id="addSubjectForm" asp-action="AddSubject" method="post" class="d-none">
                            <input type="text" name="subjectName" placeholder="Ime predmeta" class="form-control mb-1"
                                style="display:inline-block; width:auto;" />
                            <button type="submit" class="btn btn-success btn-sm">Dodaj</button>
                        </form>
                    </div>
                </div>
            </aside>

            <!-- Center column -->
            <section class="center-column">
                <section class="focus-card">
                    <section class="weekly-card">
                        <div class="weekly-header">
                            <div>
                                <div class="weekly-label">Weekly focus</div>
                                <div class="weekly-time">6h 40m</div>
                            </div>
                            <div class="weekly-change">+12%</div>
                        </div>
                        <div class="weekly-chart">
                            <div class="chart-bar"></div>
                            <div class="chart-bar"></div>
                            <div class="chart-bar"></div>
                            <div class="chart-bar"></div>
                            <div class="chart-bar"></div>
                            <div class="chart-bar"></div>
                            <div class="chart-bar"></div>
                        </div>
                    </section>

                    <div class="timer-card">
                        <div class="timer-subject-label" id="timerSubjectLabel"></div>
                        <div class="timer-circle">
                            <div class="timer-inner">
                                00:00
                            </div>
                        </div>
                        <div class="timer-actions">
                            <button class="btn-pill primary">Start</button>
                            <button class="btn-pill secondary">Reset</button>
                        </div>
                    </div>
                </section>

                <section class="tasks-card">
                    <div class="card-title">Today’s Tasks</div>
                    <ul class="task-list">
                        @foreach (var task in Model.StudyTasks)
                        {
                            <li class="task-item">
                                <label class="task-left">
                                    <!-- Checkbox default unchecked for now; update to use task.Completed when available -->
                                    <input type="checkbox" class="task-checkbox-input" />
                                    <span class="task-checkbox"></span>
                                    <div>
                                        <span>@task.Description</span>
                                        @if (task.Subject != null)
                                        {
                                            <span class="task-subject">@task.Subject.Name</span>
                                        }
                                    </div>
                                </label>
                            </li>
                        }
                    </ul>
                </section>

                <section class="quick-add-card">
                    <div class="quick-add-label">Quick Add</div>
                    <div class="quick-add-row">
                        <input class="quick-input" id="quickAddInput" placeholder="New task..." />
                        <button class="btn-add" id="quickAddButton">Add</button>
                    </div>
                    <div class="quick-tip">Press <strong>Enter</strong> to add quickly.</div>
                </section>
            </section>

            @* Right column (če jo boš kdaj rabil)
            <section class="right-column">
            </section>
            *@
        </main>
    </div>

    <!-- Timer modal -->
    <div class="timer-modal-backdrop" id="timerModal">
        <div class="timer-modal">
            <h2 class="timer-modal-title">Set focus time</h2>
            <p class="timer-modal-text">How many minutes do you want to focus?</p>

            <div class="timer-modal-input-row">
                <input type="number" id="timerMinutesInput" min="1" max="180" value="25" />
                <span class="timer-modal-input-label">minutes</span>
            </div>

            <div class="timer-modal-presets">
                <button type="button" class="timer-preset-btn" data-minutes="5">5 min</button>
                <button type="button" class="timer-preset-btn" data-minutes="15">15 min</button>
                <button type="button" class="timer-preset-btn" data-minutes="25">25 min</button>
            </div>

            <div class="timer-modal-input-row" style="margin-top: 10px;">
                <span class="timer-modal-input-label">Subject</span>
                <select id="timerSubjectSelect">
                    <option value="">Select subject…</option>
                    @foreach (var subject in Model.Subjects)
                    {
                        <option value="@subject.Name">@subject.Name</option>
                    }
                </select>
            </div>

            <div class="timer-modal-actions">
                <button type="button" class="btn-pill secondary" data-action="cancel">Cancel</button>
                <button type="button" class="btn-pill primary" data-action="confirm">Start</button>
            </div>
        </div>
    </div>

    <!-- Time's up modal -->
    <div class="timer-modal-backdrop" id="timerEndModal">
        <div class="timer-modal">
            <h2 class="timer-modal-title">Time’s up! ⏰</h2>
            <p class="timer-modal-text">Did you get everything done?</p>

            <div class="timer-modal-actions timer-end-actions">
                <button type="button" class="btn-pill secondary" id="timerEndYes">Yes!</button>
                <button type="button" class="btn-pill primary timer-end-no" id="timerEndNo">
                    No :(
                </button>
            </div>

            <p class="timer-end-hint">
                We’ll start a new session at 50% of your last focus time.
            </p>
        </div>
    </div>

    <!-- Quick Add modal -->
    <div class="timer-modal-backdrop" id="quickAddModal">
        <div class="timer-modal">
            <h2 class="timer-modal-title">Let’s get it done!</h2>
            <p class="timer-modal-text" id="quickAddTaskLabel"></p>

            <div class="timer-modal-input-row">
                <span class="timer-modal-input-label">Duration</span>
            </div>

            <div class="timer-modal-presets">
                <button type="button" class="timer-preset-btn quickadd-preset" data-minutes="5">5 min</button>
                <button type="button" class="timer-preset-btn quickadd-preset" data-minutes="10">10 min</button>
                <button type="button" class="timer-preset-btn quickadd-preset" data-minutes="25">25 min</button>
            </div>

            <div class="timer-modal-input-row">
                <input type="number" id="quickAddMinutesInput" min="1" max="180" value="25" />
                <span class="timer-modal-input-label">minutes</span>
            </div>

            <div class="timer-modal-input-row" style="margin-top: 10px;">
                <span class="timer-modal-input-label">Subject</span>
                <select id="quickAddSubject">
                    <option value="">Select subject…</option>
                    @foreach (var subject in Model.Subjects)
                    {
                        <option value="@subject.Name">@subject.Name</option>
                    }
                </select>
            </div>

            <div class="timer-modal-actions">
                <button type="button" class="btn-pill secondary" id="quickAddCancel">Cancel</button>
                <button type="button" class="btn-pill primary" id="quickAddConfirm">Save task</button>
            </div>
        </div>
    </div>

    <!-- Empty task error modal -->
    <div class="timer-modal-backdrop" id="quickAddErrorModal">
        <div class="timer-modal">
            <button type="button" class="modal-close-btn" id="quickAddErrorClose">✕</button>
            <h2 class="timer-modal-title">Oops!</h2>
            <p class="timer-modal-text" id="quickAddErrorText">
                You need to add a task description first...
            </p>
        </div>
    </div>

    <!-- Add Subject modal -->
    <div class="timer-modal-backdrop" id="addSubjectModal">
        <div class="timer-modal">
            <button type="button" class="modal-close-btn" id="addSubjectClose">✕</button>

            <h2 class="timer-modal-title">Even more work? Really?</h2>
            <p class="timer-modal-text">Add a new subject to keep things organized.</p>

            <form id="addSubjectModalForm" asp-action="AddSubject" method="post">
                <div class="timer-modal-input-row">
                    <input type="text" id="addSubjectInput" name="subjectName" placeholder="Subject name..."
                        autocomplete="off" />
                </div>

                <div class="timer-modal-actions">
                    <button type="button" class="btn-pill secondary" id="addSubjectCancel">Cancel</button>
                    <button type="submit" class="btn-pill primary">Add subject</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        window.studyBuddyConfig = {
            createStudySessionUrl: '@Url.Action("CreateFromTimer", "StudySessions")',
            createQuickTaskUrl: '@Url.Action("CreateFromQuickAdd", "StudyTasks")'
        };
    </script>

    <script src="~/js/site.js" asp-append-version="true"></script>
</body>

</html>